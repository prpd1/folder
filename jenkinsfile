pipeline{
    agent{
        node{
            label 'agent-java'
        }
    }
    stages{
        stage("build"){
             steps {
                sh 'echo ========build started======='
                sh 'mvn clean install -Dmaven.test.skip=true'
                }
    }   
        stage('Unit Test') {
            steps {
                echo '<--------------- Unit Testing started  --------------->'
                sh 'mvn surefire-report:report'
                echo '<------------- Unit Testing stopped  --------------->'
            }
        }
        stage ("Sonar Analysis") {
            environment {
               scannerHome = tool 'sonarqubescanner'
            }
            steps {
                echo '<--------------- Sonar Analysis started  --------------->'
                withSonarQubeEnv('sonarqubeserver') {    
                    sh "${scannerHome}/bin/sonar-scanner"
                echo '<--------------- Sonar Analysis stopped  --------------->'
                }    
               
            }   
        }
    }
}